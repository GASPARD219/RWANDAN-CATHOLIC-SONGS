<!DOCTYPE html>
<html lang="rw">
<head>
    <img src="logo.png.jpg" alt="My Logo" width="150">


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="app_name_user">INDIRIMBO ZA GATOLIKA</title>
    
    <!-- PWA META TAGS -->
    <meta name="theme-color" content="#4b0082">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="Shakira indirimbo za Gatolika">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="./icons/icon-192.png">
    
    <style>
        /* ===== GENERAL STYLES ===== */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
            padding-bottom: 80px; /* Space for fixed bottom buttons */
        }
        
        /* ===== LANGUAGE SWITCHER ===== */
        .language-switcher-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .language-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .language-current {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #4b0082;
            border-radius: 25px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-weight: bold;
            color: #4b0082;
            transition: all 0.3s;
            min-width: 150px;
            justify-content: space-between;
        }
        
        .language-current:hover {
            background: white;
            box-shadow: 0 4px 12px rgba(75, 0, 130, 0.2);
            transform: translateY(-2px);
        }
        
        .language-flag {
            font-size: 20px;
        }
        
        .language-name {
            flex: 1;
            text-align: center;
            font-size: 14px;
        }
        
        .language-arrow {
            font-size: 12px;
            color: #666;
        }
        
        .language-options {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            min-width: 180px;
            z-index: 1001;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .language-options button {
            width: 100%;
            padding: 15px 20px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: #333;
            transition: all 0.2s;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .language-options button:last-child {
            border-bottom: none;
        }
        
        .language-options button:hover {
            background: #f8f9fa;
            color: #4b0082;
        }
        
        .language-options button.active {
            background: #e8f4fd;
            color: #4b0082;
            font-weight: bold;
        }
        
        /* Language notification */
        .language-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4b0082;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 10000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* ===== NOTIFICATION BADGE ===== */
        .notification-badge {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #dc3545;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            cursor: pointer;
            animation: pulse 2s infinite;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .notification-panel {
            display: none;
            position: fixed;
            top: 60px;
            left: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            z-index: 10000;
            overflow: hidden;
            border: 2px solid #4b0082;
        }
        
        .notification-panel.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .notification-header {
            background: linear-gradient(135deg, #4b0082, #6a5acd);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notification-header h4 {
            margin: 0;
            font-size: 16px;
        }
        
        .notification-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .notification-item {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #4b0082;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .notification-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .notification-item.unread {
            background: #e8f4fd;
            border-left-color: #17a2b8;
        }
        
        .notification-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .notification-time {
            font-size: 11px;
            color: #666;
        }
        
        .notification-message {
            font-size: 13px;
            color: #555;
        }
        
        /* ===== AUTH MODAL ===== */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .auth-modal.active {
            display: flex;
        }
        
        .auth-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: #4b0082;
            border-bottom-color: #4b0082;
        }
        
        .auth-content {
            display: none;
        }
        
        .auth-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4b0082;
            font-size: 16px;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        
        .form-group input:focus {
            border-color: #4b0082;
            outline: none;
        }
        
        .auth-error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .auth-error.show {
            display: block;
        }
        
        .auth-success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #c3e6cb;
            display: none;
            text-align: center;
        }
        
        .auth-success.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .auth-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .auth-buttons button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .auth-submit {
            background: #28a745;
            color: white;
        }
        
        .auth-submit:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .auth-cancel {
            background: #6c757d;
            color: white;
        }
        
        .auth-cancel:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .auth-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .google-login {
            background: #4285F4;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .google-login:hover {
            background: #357ae8;
            transform: translateY(-2px);
        }
        
        .user-profile {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            border-radius: 25px;
            padding: 10px 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            align-items: center;
            gap: 10px;
        }
        
        .user-profile.show {
            display: flex;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #4b0082;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .user-info {
            font-size: 14px;
            color: #333;
        }
        
        .user-email {
            font-weight: bold;
            color: #4b0082;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .user-stats {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }
        
        /* ===== HEADER ===== */
        header {
            background: linear-gradient(135deg, #4b0082, #6a5acd);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        #songCount {
            margin-top: 15px;
            font-size: 16px;
            opacity: 0.9;
            background: rgba(255,255,255,0.1);
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
        }
        
        /* ===== FIXED BOTTOM BUTTONS ===== */
        .bottom-screen-buttons {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, #4b0082, #6a5acd);
            padding: 15px;
            display: flex;
            gap: 15px;
            justify-content: center;
            z-index: 1000;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.2);
            border-top: 3px solid white;
        }
        
        .bottom-screen-buttons button {
            flex: 1;
            max-width: 300px;
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-height: 50px;
        }
        
        .admin-btn-bottom {
            background: #28a745;
            color: white;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }
        
        .contact-btn-bottom {
            background: #17a2b8;
            color: white;
            box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
        }
        
        .notification-btn-bottom {
            background: #ffc107;
            color: #856404;
            box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
        }
        
        .bottom-screen-buttons button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .admin-btn-bottom:hover {
            background: #218838;
        }
        
        .contact-btn-bottom:hover {
            background: #138496;
        }
        
        .notification-btn-bottom:hover {
            background: #e0a800;
        }
        
        /* ===== PWA BUTTON IN HEADER ===== */
        .header-pwa-btn {
            margin-top: 15px;
        }
        
        .header-pwa-btn button {
            padding: 10px 20px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-pwa-btn button:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        /* ===== SEARCH BOX ===== */
        .search-box {
            text-align: center;
            padding: 25px 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .search-box input {
            flex: 2;
            min-width: 250px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .search-box input:focus {
            border-color: #4b0082;
            outline: none;
        }
        
        .search-box select {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }
        
        .search-box button {
            padding: 15px 25px;
            background: #4b0082;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .search-box button:hover {
            background: #5a0d9c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* ===== SECTION NAV ===== */
        #sectionNav {
            background: linear-gradient(135deg, #6a5acd, #9370db);
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            position: sticky;
            top: 140px;
            z-index: 99;
        }
        
        #sectionNav button {
            padding: 12px 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.3s;
            font-size: 14px;
            white-space: nowrap;
            font-weight: bold;
        }
        
        #sectionNav button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        #sectionNav button:active {
            background: #4b0082;
        }
        
        /* ===== SECTIONS ===== */
        .section {
            display: none;
            padding: 40px 20px;
            max-width: 1400px;
            margin: 0 auto;
            margin-bottom: 30px;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .section h2 {
            color: #4b0082;
            border-bottom: 3px solid #4b0082;
            padding-bottom: 20px;
            margin-bottom: 30px;
            font-size: 32px;
            position: relative;
        }
        
        .section h2::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100px;
            height: 3px;
            background: #6a5acd;
        }
        
        /* ===== SONGS LIST ===== */
        .songs-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
        }
        
        .song {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 6px solid #4b0082;
            transition: all 0.3s;
            animation: fadeIn 0.5s ease;
        }
        
        .song:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-left-color: #6a5acd;
        }
        
        .song-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .song-title {
            color: #333;
            margin: 0;
            font-size: 22px;
            line-height: 1.4;
            flex: 1;
        }
        
        .song-date {
            color: #666;
            font-size: 14px;
            white-space: nowrap;
            margin-left: 15px;
            background: #f8f9fa;
            padding: 4px 10px;
            border-radius: 12px;
        }
        
        .song-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .song-section, .song-size, .download-count {
            background: #e9ecef;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            color: #495057;
            font-weight: 500;
        }
        
        .song-section {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .song-size {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .download-count {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .song-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .download-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 15px;
            gap: 8px;
        }
        
        .download-btn:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .play-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: all 0.3s;
            gap: 8px;
        }
        
        .play-btn:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .no-songs {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 60px;
            grid-column: 1 / -1;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
            font-size: 18px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== CONTACT MODAL ===== */
        .contact-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .contact-modal.active {
            display: flex;
        }
        
        .contact-form-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        
        .contact-header {
            color: #4b0082;
            margin-top: 0;
            text-align: center;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin: 20px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4b0082;
            font-size: 16px;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #4b0082;
            outline: none;
        }
        
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
            font-family: Arial, sans-serif;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .form-actions button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .send-btn {
            background: #28a745;
            color: white;
        }
        
        .send-btn:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .cancel-btn {
            background: #6c757d;
            color: white;
        }
        
        .cancel-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .form-error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .form-error.show {
            display: block;
        }
        
        .form-success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #c3e6cb;
            display: none;
            text-align: center;
        }
        
        .form-success.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .contact-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
            border-left: 4px solid #4b0082;
        }
        
        /* ===== PWA STYLES ===== */
        .offline-badge {
            display: inline-block;
            background: #ffc107;
            color: #856404;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 5px;
            vertical-align: middle;
        }
        
        .pwa-notification {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: #4b0082;
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10000;
            display: none;
            max-width: 300px;
            font-size: 14px;
        }
        
        .pwa-notification button {
            margin-top: 8px;
            padding: 6px 12px;
            background: white;
            color: #4b0082;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }
            
            .language-switcher-container {
                top: 15px;
                right: 15px;
            }
            
            .language-current {
                padding: 8px 15px;
                min-width: 130px;
            }
            
            .language-name {
                font-size: 12px;
            }
            
            .language-flag {
                font-size: 18px;
            }
            
            .search-box {
                flex-direction: column;
                padding: 20px;
                top: 0;
            }
            
            .search-box input,
            .search-box select,
            .search-box button {
                width: 100%;
                max-width: 100%;
            }
            
            #sectionNav {
                top: 200px;
                padding: 10px;
            }
            
            #sectionNav button {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .songs-list {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .section {
                padding: 20px;
            }
            
            .song-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .song-date {
                margin-left: 0;
                align-self: flex-start;
            }
            
            .contact-form-container {
                width: 95%;
                padding: 20px;
                margin: 10px;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .bottom-screen-buttons {
                flex-direction: column;
                align-items: center;
                padding: 12px;
            }
            
            .bottom-screen-buttons button {
                width: 90%;
                max-width: 90%;
                margin-bottom: 8px;
            }
            
            body {
                padding-bottom: 140px;
            }
        }
        
        @media (max-width: 480px) {
            .language-switcher-container {
                top: 10px;
                right: 10px;
            }
            
            .language-current {
                padding: 6px 12px;
                min-width: 110px;
            }
            
            .language-name {
                display: none;
            }
            
            .language-arrow {
                margin-left: auto;
            }
            
            .bottom-screen-buttons button {
                min-height: 45px;
                font-size: 14px;
                padding: 12px 20px;
            }
            
            body {
                padding-bottom: 130px;
            }
        }
    </style>
</head>
<body>
    <!-- Language Switcher -->
    <div class="language-switcher-container">
        <div id="languageSwitcher"></div>
    </div>

    <!-- Notification Badge -->
    <div id="notificationBadge" class="notification-badge" onclick="toggleNotificationPanel()" style="display: none;">0</div>
    
    <!-- Notification Panel -->
    <div id="notificationPanel" class="notification-panel">
        <div class="notification-header">
            <h4 data-translate="notifications">Notifications</h4>
            <button onclick="clearAllNotifications()" style="background: none; border: none; color: white; cursor: pointer; font-size: 12px;">
                üóëÔ∏è Clear All
            </button>
        </div>
        <div id="notificationList" class="notification-list">
            <!-- Notifications will appear here -->
        </div>
    </div>

    <!-- User Profile -->
    <div id="userProfile" class="user-profile">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-info">
            <div class="user-email" id="userEmailDisplay">User</div>
            <div class="user-stats">
                <span>üì•: <span id="userDownloads">0</span></span>
                <span>üëÅÔ∏è: <span id="userViews">0</span></span>
            </div>
        </div>
        <button class="logout-btn" onclick="logoutUser()">üö™</button>
    </div>

    <!-- Header -->
    <header>
        <h1 data-translate="app_name_user">INDIRIMBO ZA GATOLIKA</h1>
        <p id="songCount" data-translate="welcome_subtitle">SHAKA INDIRIMBO UKURIKIJE IZINA CYANGWA IGICE CYA MISSA</p>
        
        <!-- PWA Button in Header -->
        <div class="header-pwa-btn">
            <button id="pwaButton" style="display: none;" onclick="showPWAInfo()" data-translate="install_app">
                <span>üì±</span> <span>Kwinjiza App</span>
            </button>
        </div>
    </header>

    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal active">
        <div class="auth-container">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('signup')" data-translate="signup">Iyandikishe</button>
                <button class="auth-tab" onclick="switchAuthTab('login')" data-translate="login">Injira</button>
                <button class="auth-tab" onclick="continueWithoutLogin()" data-translate="continue_without_login">Komeza utarinjiye</button>
            </div>
            
            <!-- Signup Form -->
            <div id="signupContent" class="auth-content active">
                <form id="signupForm" class="auth-form">
                    <div class="form-group">
                        <label for="signupEmail" data-translate="email">Email:</label>
                        <input type="email" id="signupEmail" placeholder="shyiramo email yawe..." required>
                        <div id="signupEmailError" class="auth-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupPassword" data-translate="password">Ijambobanga:</label>
                        <input type="password" id="signupPassword" placeholder="shyiramo ijambobanga..." required minlength="6">
                        <div id="signupPasswordError" class="auth-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword" data-translate="confirm_password">Emeza ijambobanga:</label>
                        <input type="password" id="confirmPassword" placeholder="ongera ushyiremo ijambobanga..." required>
                        <div id="confirmPasswordError" class="auth-error"></div>
                    </div>
                    
                    <div id="signupSuccess" class="auth-success">
                        <strong data-translate="signup_success">‚úÖ Wiyandikishije neza!</strong>
                        <p data-translate="redirecting">Ugiye kuri welcome page...</p>
                    </div>
                    
                    <div class="auth-buttons">
                        <button type="submit" class="auth-submit" id="signupButton">
                            <span>üìù</span> <span data-translate="signup">Iyandikishe</span>
                        </button>
                    </div>
                </form>
                
                <button class="google-login" onclick="loginWithGoogle()">
                    <span>üîµ</span> <span data-translate="continue_with_google">Komeza ukoresheje Google</span>
                </button>
            </div>
            
            <!-- Login Form -->
            <div id="loginContent" class="auth-content">
                <form id="loginForm" class="auth-form">
                    <div class="form-group">
                        <label for="loginEmail" data-translate="email">Email:</label>
                        <input type="email" id="loginEmail" placeholder="shyiramo email yawe..." required>
                        <div id="loginEmailError" class="auth-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword" data-translate="password">Ijambobanga:</label>
                        <input type="password" id="loginPassword" placeholder="shyiramo ijambobanga..." required>
                        <div id="loginPasswordError" class="auth-error"></div>
                    </div>
                    
                    <div id="loginSuccess" class="auth-success">
                        <strong data-translate="login_success">‚úÖ Winjiye neza!</strong>
                        <p data-translate="redirecting">Ugiye kuri welcome page...</p>
                    </div>
                    
                    <div class="auth-buttons">
                        <button type="submit" class="auth-submit" id="loginButton">
                            <span>üîë</span> <span data-translate="login">Injira</span>
                        </button>
                    </div>
                </form>
                
                <button class="google-login" onclick="loginWithGoogle()">
                    <span>üîµ</span> <span data-translate="continue_with_google">Komeza ukoresheje Google</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content (hidden until authenticated) -->
    <div id="mainContent" style="display: none;">
        <!-- Search Box -->
        <div class="search-box">
            <input type="text" id="searchInput" data-translate="search_songs_placeholder" placeholder="Shaka indirimbo..." 
                   oninput="searchSongs()" autocomplete="off">
            <select id="sectionFilter" data-translate="filter_section_placeholder">
                <option value="" data-translate="filter_by_section">-- Shaka ukurikije igice --</option>
                <!-- Options will be populated by JavaScript -->
            </select>
            <button onclick="clearFilters()" data-translate="clear_user">Subira</button>
        </div>

        <!-- Section Navigation -->
        <nav id="sectionNav">
            <!-- Navigation buttons will be added by JavaScript -->
        </nav>

        <!-- Sections Container -->
        <div id="sectionsContainer">
            <!-- Songs will be displayed here -->
        </div>

        <!-- Fixed Bottom Screen Buttons -->
        <div class="bottom-screen-buttons">
            <button class="admin-btn-bottom" onclick="window.location.href='admin.html'">
                <span>üîë</span> <span data-translate="admin_login_user">Admin Login</span>
            </button>
            <button class="notification-btn-bottom" onclick="toggleNotificationPanel()">
                <span>üîî</span> <span data-translate="notifications">Notifications</span>
            </button>
            <button class="contact-btn-bottom" onclick="showContactForm()">
                <span>üìß</span> <span data-translate="contact_us_user">Twandikire</span>
            </button>
        </div>
    </div>

    <!-- Contact Form Modal -->
    <div id="contactModal" class="contact-modal">
        <div class="contact-form-container">
            <h3 class="contact-header">
                <span>üìß</span> <span data-translate="contact_us_user">Twandikire</span>
            </h3>
            
            <form id="contactForm">
                <div class="form-group">
                    <label for="userEmail" data-translate="your_email">Email Yawe:</label>
                    <input type="email" id="userEmail" data-translate="email_placeholder" placeholder="shyiramo email yawe..." required>
                    <div id="emailError" class="form-error" data-translate="email_required">Shyiramo email nterinze!</div>
                </div>
                
                <div class="form-group">
                    <label for="userMessage" data-translate="your_message">Ubutumwa:</label>
                    <textarea id="userMessage" data-translate="message_placeholder" placeholder="Andika ubutumwa wawe... (min: 10 imibare)" required minlength="10"></textarea>
                    <div id="messageError" class="form-error" data-translate="message_required">Ubutumwa bukenewe (min: 10 imibare)!</div>
                </div>
                
                <div id="formSuccess" class="form-success">
                    <strong data-translate="message_sent">‚úÖ Ubutumwa bwawe bwoherejwe!</strong>
                    <p data-translate="we_will_reply">Ntugire ikibazo, turabasubiza vuba.</p>
                </div>
                
                <div class="contact-info">
                    <strong data-translate="note">üîî Icyitonderwa:</strong>
                    <p>1. <span data-translate="email_usage">Email yawe izakoreshwa gusa kugirango dukubwire.</span></p>
                    <p>2. <span data-translate="reply_time">Turabasubiza mu gihe gito.</span></p>
                    <p>3. <span data-translate="message_types">Ubutumwa buri rusange: amakuru, ibibazo, amanota, etc.</span></p>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="send-btn" id="sendButton">
                        <span>üì§</span> <span data-translate="send_message">Ohereza Ubutumwa</span>
                    </button>
                    <button type="button" class="cancel-btn" onclick="hideContactForm()">
                        <span>‚úñÔ∏è</span> <span data-translate="cancel">Hagarika</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- PWA Notification -->
    <div id="pwaNotification" class="pwa-notification">
        <span id="pwaMessage"></span>
        <button onclick="hidePWANotification()" data-translate="ok">OK</button>
    </div>

    <!-- Ask Notification Permission Modal -->
    <div id="notificationPermissionModal" class="contact-modal" style="display: none;">
        <div class="contact-form-container">
            <h3 class="contact-header">
                <span>üîî</span> <span data-translate="enable_notifications">Emeza Notifications</span>
            </h3>
            
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 60px; margin-bottom: 20px;">üì±</div>
                <h4 data-translate="notification_benefits">Kubona notifications</h4>
                <p style="margin: 15px 0; line-height: 1.6;" data-translate="notification_benefits_desc">
                    ‚Ä¢ Menya iyo hari indirimbo nshya<br>
                    ‚Ä¢ Kubona amakuru ya downloads<br>
                    ‚Ä¢ Amatangazo ya admin<br>
                    ‚Ä¢ Ibyiza byose by'App
                </p>
                
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button onclick="enableNotifications()" style="flex: 1; padding: 15px; background: #4b0082; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                        <span>‚úÖ</span> <span data-translate="enable">Emeza</span>
                    </button>
                    <button onclick="skipNotifications()" style="flex: 1; padding: 15px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                        <span>‚è≠Ô∏è</span> <span data-translate="skip">Reka</span>
                    </button>
                </div>
                
                <p style="margin-top: 15px; font-size: 12px; color: #666;">
                    <span data-translate="notification_note">Urashobora guhindura settings muri browser yawe.</span>
                </p>
            </div>
        </div>
    </div>

    <script>
        // ===== LANGUAGE MANAGEMENT =====
        const translations = {
            'rw': {
                'app_name_user': 'INDIRIMBO ZA GATOLIKA',
                'welcome_subtitle': 'SHAKA INDIRIMBO UKURIKIJE IZINA CYANGWA IGICE CYA MISSA',
                'install_app': 'Kwinjiza App',
                'signup': 'Iyandikishe',
                'login': 'Injira',
                'continue_without_login': 'Komeza utarinjiye',
                'email': 'Email:',
                'password': 'Ijambobanga:',
                'confirm_password': 'Emeza ijambobanga:',
                'signup_success': '‚úÖ Wiyandikishije neza!',
                'redirecting': 'Ugiye kuri welcome page...',
                'continue_with_google': 'Komeza ukoresheje Google',
                'login_success': '‚úÖ Winjiye neza!',
                'notifications': 'Notifications',
                'admin_login_user': 'Admin Login',
                'contact_us_user': 'Twandikire',
                'search_songs_placeholder': 'Shaka indirimbo...',
                'filter_section_placeholder': '-- Shaka ukurikije igice --',
                'filter_by_section': '-- Shaka ukurikije igice --',
                'clear_user': 'Subira',
                'all_sections': 'Byose',
                'intro': 'Gutangira',
                'forgiveness': 'Nyagasani Tubabarire',
                'glory_to_god': 'Imana nisingizwe mu ijuru',
                'psalms': 'Zaburi',
                'alleluia': 'Alleluya',
                'creed': 'Indanga kwemera',
                'prayers': 'Ibisabisho',
                'offertory': 'Gutura',
                'holy': 'Nyirubutagatifu',
                'lamb_of_god': 'Ntama w\'Imana',
                'communion': 'Gusangira',
                'thanksgiving': 'Gushimira',
                'conclusion': 'Gusoza',
                'mary': 'Bikiramariya',
                'saints': 'Abatagatifu bose',
                'wedding': 'Gushyingirwa',
                'funeral': 'Ibitaramo',
                'advent': 'Adiventi',
                'christmas': 'Noheli',
                'lent': 'Igisibo',
                'easter': 'Pasika',
                'ascension': 'Asensiyo',
                'pentecost': 'Rohomutagatifu',
                'other_songs': 'Other More songs',
                'songs': 'Indirimbo',
                'no_songs': 'Nta ndirimbo',
                'download_user': 'Pakura',
                'preview_user': 'Reba',
                'your_email': 'Email Yawe:',
                'email_placeholder': 'shyiramo email yawe...',
                'email_required': 'Shyiramo email nterinze!',
                'your_message': 'Ubutumwa:',
                'message_placeholder': 'Andika ubutumwa wawe... (min: 10 imibare)',
                'message_required': 'Ubutumwa bukenewe (min: 10 imibare)!',
                'message_sent': '‚úÖ Ubutumwa bwawe bwoherejwe!',
                'we_will_reply': 'Ntugire ikibazo, turabasubiza vuba.',
                'note': 'üîî Icyitonderwa:',
                'email_usage': 'Email yawe izakoreshwa gusa kugirango dukubwire.',
                'reply_time': 'Turabasubiza mu gihe gito.',
                'message_types': 'Ubutumwa buri rusange: amakuru, ibibazo, amanota, etc.',
                'send_message': 'Ohereza Ubutumwa',
                'cancel': 'Hagarika',
                'enable_notifications': 'Emeza Notifications',
                'notification_benefits': 'Kubona notifications',
                'notification_benefits_desc': '‚Ä¢ Menya iyo hari indirimbo nshya<br>‚Ä¢ Kubona amakuru ya downloads<br>‚Ä¢ Amatangazo ya admin<br>‚Ä¢ Ibyiza byose by\'App',
                'enable': 'Emeza',
                'skip': 'Reka',
                'notification_note': 'Urashobora guhindura settings muri browser yawe.',
                'no_notifications': 'Nta notifications',
                'search': 'Shaka'
            },
            'en': {
                'app_name_user': 'CATHOLIC SONGS',
                'welcome_subtitle': 'SEARCH SONGS BY NAME OR MASS SECTION',
                'install_app': 'Install App',
                'signup': 'Sign Up',
                'login': 'Login',
                'continue_without_login': 'Continue without login',
                'email': 'Email:',
                'password': 'Password:',
                'confirm_password': 'Confirm password:',
                'signup_success': '‚úÖ Signed up successfully!',
                'redirecting': 'Redirecting to welcome page...',
                'continue_with_google': 'Continue with Google',
                'login_success': '‚úÖ Logged in successfully!',
                'notifications': 'Notifications',
                'admin_login_user': 'Admin Login',
                'contact_us_user': 'Contact Us',
                'search_songs_placeholder': 'Search songs...',
                'filter_section_placeholder': '-- Search by section --',
                'filter_by_section': '-- Search by section --',
                'clear_user': 'Clear',
                'all_sections': 'All',
                'intro': 'Intro',
                'forgiveness': 'Forgiveness',
                'glory_to_god': 'Glory to God',
                'psalms': 'Psalms',
                'alleluia': 'Alleluia',
                'creed': 'Creed',
                'prayers': 'Prayers',
                'offertory': 'Offertory',
                'holy': 'Holy',
                'lamb_of_god': 'Lamb of God',
                'communion': 'Communion',
                'thanksgiving': 'Thanksgiving',
                'conclusion': 'Conclusion',
                'mary': 'Mary',
                'saints': 'Saints',
                'wedding': 'Wedding',
                'funeral': 'Funeral',
                'advent': 'Advent',
                'christmas': 'Christmas',
                'lent': 'Lent',
                'easter': 'Easter',
                'ascension': 'Ascension',
                'pentecost': 'Pentecost',
                'other_songs': 'Other More songs',
                'songs': 'Songs',
                'no_songs': 'No songs',
                'download_user': 'Download',
                'preview_user': 'Preview',
                'your_email': 'Your Email:',
                'email_placeholder': 'enter your email...',
                'email_required': 'Enter valid email!',
                'your_message': 'Message:',
                'message_placeholder': 'Write your message... (min: 10 characters)',
                'message_required': 'Message required (min: 10 characters)!',
                'message_sent': '‚úÖ Your message sent!',
                'we_will_reply': 'Don\'t worry, we will reply soon.',
                'note': 'üîî Note:',
                'email_usage': 'Your email will be used only to contact you.',
                'reply_time': 'We reply in short time.',
                'message_types': 'General messages: information, questions, notes, etc.',
                'send_message': 'Send Message',
                'cancel': 'Cancel',
                'enable_notifications': 'Enable Notifications',
                'notification_benefits': 'Get notifications',
                'notification_benefits_desc': '‚Ä¢ Know when there are new songs<br>‚Ä¢ Get download information<br>‚Ä¢ Admin announcements<br>‚Ä¢ All app benefits',
                'enable': 'Enable',
                'skip': 'Skip',
                'notification_note': 'You can change settings in your browser.',
                'no_notifications': 'No notifications',
                'search': 'Search'
            },
            'fr': {
                'app_name_user': 'CHANTS CATHOLIQUES',
                'welcome_subtitle': 'RECHERCHEZ DES CHANTS PAR NOM OU SECTION DE MESSE',
                'install_app': 'Installer l\'App',
                'signup': 'S\'inscrire',
                'login': 'Connexion',
                'continue_without_login': 'Continuer sans connexion',
                'email': 'Email:',
                'password': 'Mot de passe:',
                'confirm_password': 'Confirmer mot de passe:',
                'signup_success': '‚úÖ Inscription r√©ussie!',
                'redirecting': 'Redirection vers la page d\'accueil...',
                'continue_with_google': 'Continuer avec Google',
                'login_success': '‚úÖ Connect√© avec succ√®s!',
                'notifications': 'Notifications',
                'admin_login_user': 'Connexion Admin',
                'contact_us_user': 'Contactez-nous',
                'search_songs_placeholder': 'Rechercher des chants...',
                'filter_section_placeholder': '-- Rechercher par section --',
                'filter_by_section': '-- Rechercher par section --',
                'clear_user': 'Effacer',
                'all_sections': 'Tous',
                'intro': 'Intro',
                'forgiveness': 'Pardon',
                'glory_to_god': 'Gloire √† Dieu',
                'psalms': 'Psaumes',
                'alleluia': 'All√©luia',
                'creed': 'Credo',
                'prayers': 'Pri√®res',
                'offertory': 'Offertoire',
                'holy': 'Saint',
                'lamb_of_god': 'Agneau de Dieu',
                'communion': 'Communion',
                'thanksgiving': 'Action de gr√¢ces',
                'conclusion': 'Conclusion',
                'mary': 'Marie',
                'saints': 'Saints',
                'wedding': 'Mariage',
                'funeral': 'Fun√©railles',
                'advent': 'Avent',
                'christmas': 'No√´l',
                'lent': 'Car√™me',
                'easter': 'P√¢ques',
                'ascension': 'Ascension',
                'pentecost': 'Pentec√¥te',
                'other_songs': 'Autres chants',
                'songs': 'Chants',
                'no_songs': 'Aucun chant',
                'download_user': 'T√©l√©charger',
                'preview_user': 'Aper√ßu',
                'your_email': 'Votre Email:',
                'email_placeholder': 'entrez votre email...',
                'email_required': 'Entrez un email valide!',
                'your_message': 'Message:',
                'message_placeholder': '√âcrivez votre message... (min: 10 caract√®res)',
                'message_required': 'Message requis (min: 10 caract√®res)!',
                'message_sent': '‚úÖ Votre message envoy√©!',
                'we_will_reply': 'Ne vous inqui√©tez pas, nous r√©pondrons bient√¥t.',
                'note': 'üîî Note:',
                'email_usage': 'Votre email sera utilis√© uniquement pour vous contacter.',
                'reply_time': 'Nous r√©pondons rapidement.',
                'message_types': 'Messages g√©n√©raux: informations, questions, notes, etc.',
                'send_message': 'Envoyer Message',
                'cancel': 'Annuler',
                'enable_notifications': 'Activer Notifications',
                'notification_benefits': 'Recevoir notifications',
                'notification_benefits_desc': '‚Ä¢ Savoir quand il y a de nouveaux chants<br>‚Ä¢ Obtenir informations t√©l√©chargements<br>‚Ä¢ Annonces admin<br>‚Ä¢ Tous avantages app',
                'enable': 'Activer',
                'skip': 'Passer',
                'notification_note': 'Vous pouvez changer param√®tres dans votre navigateur.',
                'no_notifications': 'Aucune notification',
                'search': 'Rechercher'
            },
            'sw': {
                'app_name_user': 'NYIMBO ZA KIKATORIKI',
                'welcome_subtitle': 'TAFUTA NYIMBO KWA JINA AU SEHEMU YA MISHA',
                'install_app': 'Sakinisha App',
                'signup': 'Jisajili',
                'login': 'Ingia',
                'continue_without_login': 'Endelea bila kuingia',
                'email': 'Barua pepe:',
                'password': 'Nenosiri:',
                'confirm_password': 'Thibitisha nenosiri:',
                'signup_success': '‚úÖ Umejisajili kikamilifu!',
                'redirecting': 'Inaelekezwa kwenye ukurasa wa karibu...',
                'continue_with_google': 'Endelea na Google',
                'login_success': '‚úÖ Umeingia kikamilifu!',
                'notifications': 'Arifa',
                'admin_login_user': 'Admin Ingia',
                'contact_us_user': 'Wasiliana nasi',
                'search_songs_placeholder': 'Tafuta nyimbo...',
                'filter_section_placeholder': '-- Tafuta kwa sehemu --',
                'filter_by_section': '-- Tafuta kwa sehemu --',
                'clear_user': 'Safisha',
                'all_sections': 'Zote',
                'intro': 'Utangulizi',
                'forgiveness': 'Maghfira',
                'glory_to_god': 'Utukufu kwa Mungu',
                'psalms': 'Zaburi',
                'alleluia': 'Haleluya',
                'creed': 'Imani',
                'prayers': 'Maombi',
                'offertory': 'Sadaka',
                'holy': 'Mtakatifu',
                'lamb_of_god': 'Mwana Kondoo wa Mungu',
                'communion': 'Ushirika',
                'thanksgiving': 'Shukrani',
                'conclusion': 'Hitimisho',
                'mary': 'Mariamu',
                'saints': 'Watakatifu',
                'wedding': 'Harusi',
                'funeral': 'Mazishi',
                'advent': 'Ufufuo',
                'christmas': 'Krismasi',
                'lent': 'Kwaresima',
                'easter': 'Pasaka',
                'ascension': 'Kupaa',
                'pentecost': 'Pentekoste',
                'other_songs': 'Nyimbo Nyingine',
                'songs': 'Nyimbo',
                'no_songs': 'Hakuna nyimbo',
                'download_user': 'Pakua',
                'preview_user': 'Onyesho',
                'your_email': 'Barua pepe yako:',
                'email_placeholder': 'ingiza barua pepe yako...',
                'email_required': 'Ingiza barua pepe halali!',
                'your_message': 'Ujumbe:',
                'message_placeholder': 'Andika ujumbe wako... (min: 10 herufi)',
                'message_required': 'Ujumbe unahitajika (min: 10 herufi)!',
                'message_sent': '‚úÖ Ujumbe wako umepelekwa!',
                'we_will_reply': 'Usijali, tutajibu hivi karibuni.',
                'note': 'üîî Kumbuka:',
                'email_usage': 'Barua pepe yako itatumika tu kukuhusiana nawe.',
                'reply_time': 'Tunajibu kwa muda mfupi.',
                'message_types': 'Ujumbe wa jumla: habari, maswali, maelezo, n.k.',
                'send_message': 'Tuma Ujumbe',
                'cancel': 'Futa',
                'enable_notifications': 'Washa Arifa',
                'notification_benefits': 'Pata arifa',
                'notification_benefits_desc': '‚Ä¢ Jua wakati kuna nyimbo mpya<br>‚Ä¢ Pata habari za upakuaji<br>‚Ä¢ Tangazo la admin<br>‚Ä¢ Faida zote za app',
                'enable': 'Washa',
                'skip': 'Ruka',
                'notification_note': 'Unaweza kubadilisha mipangilio kwenye kivinjari chako.',
                'no_notifications': 'Hakuna arifa',
                'search': 'Tafuta'
            }
        };

        const LanguageManager = {
            currentLang: 'rw',
            
            init() {
                this.currentLang = localStorage.getItem('app_language') || 'rw';
                this.applyLanguage();
                this.setupLanguageSwitcher();
            },
            
            setLanguage(lang) {
                if (translations[lang]) {
                    this.currentLang = lang;
                    localStorage.setItem('app_language', lang);
                    this.applyLanguage();
                    this.showLanguageChangeNotification(lang);
                }
            },
            
            applyLanguage() {
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.getAttribute('data-translate');
                    const translation = this.getTranslation(key);
                    if (translation) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.placeholder = translation;
                        } else if (element.tagName === 'OPTION') {
                            element.textContent = translation;
                        } else {
                            element.textContent = translation;
                        }
                    }
                });
                
                this.updateLanguageSwitcherUI();
                if (window.updateSectionNav) {
                    updateSectionNav();
                }
                if (window.updateSectionDropdowns) {
                    updateSectionDropdowns();
                }
            },
            
            getTranslation(key) {
                return translations[this.currentLang]?.[key] || translations['rw'][key] || key;
            },
            
            setupLanguageSwitcher() {
                const switcher = document.getElementById('languageSwitcher');
                if (switcher) {
                    switcher.innerHTML = `
                        <div class="language-dropdown">
                            <button class="language-current">
                                <span class="language-flag">${this.getFlag(this.currentLang)}</span>
                                <span class="language-name">${this.getLanguageName(this.currentLang)}</span>
                                <span class="language-arrow">‚ñº</span>
                            </button>
                            <div class="language-options">
                                <button onclick="LanguageManager.setLanguage('rw')" class="${this.currentLang === 'rw' ? 'active' : ''}">
                                    <span class="language-flag">üá∑üáº</span> Kinyarwanda
                                </button>
                                <button onclick="LanguageManager.setLanguage('en')" class="${this.currentLang === 'en' ? 'active' : ''}">
                                    <span class="language-flag">üá¨üáß</span> English
                                </button>
                                <button onclick="LanguageManager.setLanguage('fr')" class="${this.currentLang === 'fr' ? 'active' : ''}">
                                    <span class="language-flag">üá´üá∑</span> Fran√ßais
                                </button>
                                <button onclick="LanguageManager.setLanguage('sw')" class="${this.currentLang === 'sw' ? 'active' : ''}">
                                    <span class="language-flag">üáπüáø</span> Swahili
                                </button>
                            </div>
                        </div>
                    `;
                    
                    switcher.querySelector('.language-current').addEventListener('click', function(e) {
                        e.stopPropagation();
                        const options = this.parentElement.querySelector('.language-options');
                        options.style.display = options.style.display === 'block' ? 'none' : 'block';
                    });
                    
                    document.addEventListener('click', function() {
                        const options = document.querySelector('.language-options');
                        if (options) options.style.display = 'none';
                    });
                }
            },
            
            updateLanguageSwitcherUI() {
                const currentBtn = document.querySelector('.language-current');
                const options = document.querySelectorAll('.language-options button');
                
                if (currentBtn) {
                    currentBtn.querySelector('.language-flag').textContent = this.getFlag(this.currentLang);
                    currentBtn.querySelector('.language-name').textContent = this.getLanguageName(this.currentLang);
                }
                
                options.forEach(btn => {
                    const lang = btn.getAttribute('onclick').match(/'(\w+)'/)?.[1];
                    btn.classList.toggle('active', lang === this.currentLang);
                });
            },
            
            getFlag(lang) {
                const flags = { 'rw': 'üá∑üáº', 'en': 'üá¨üáß', 'fr': 'üá´üá∑', 'sw': 'üáπüáø' };
                return flags[lang] || 'üåê';
            },
            
            getLanguageName(lang) {
                const names = { 'rw': 'Kinyarwanda', 'en': 'English', 'fr': 'Fran√ßais', 'sw': 'Swahili' };
                return names[lang] || lang;
            },
            
            showLanguageChangeNotification(lang) {
                const messages = {
                    'rw': 'Ururimi rwahinduwe!',
                    'en': 'Language changed!',
                    'fr': 'Langue chang√©e!',
                    'sw': 'Lugha imebadilishwa!'
                };
                
                const notification = document.createElement('div');
                notification.className = 'language-notification';
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">${this.getFlag(lang)}</span>
                        <span>${messages[lang]}</span>
                    </div>
                `;
                
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #4b0082;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    z-index: 10000;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease;
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        };

        // ===== GLOBAL VARIABLES =====
        let allSongs = [];
        let currentSearchTerm = '';
        let currentFilterSection = '';
        let deferredPrompt = null;
        let songUpdateInterval = null;
        let currentUser = null;
        let notificationCount = 0;
        
        // ===== INITIALIZATION =====
        function initApp() {
            LanguageManager.init();
            setupAuthForms();
            
            // Check if user is already logged in
            checkUserSession();
            
            registerServiceWorker();
            setupInstallPrompt();
            updateOnlineStatus();
            setupContactForm();
            
            songUpdateInterval = setInterval(checkForSongUpdates, 10000);
            window.addEventListener('focus', checkForSongUpdates);
            
            // Request notification permission after 3 seconds
            setTimeout(() => {
                checkNotificationPermission();
            }, 3000);
            
            // Load user notifications
            loadUserNotifications();
        }
        
        // ===== NOTIFICATION SYSTEM =====
        function checkNotificationPermission() {
            if (!('Notification' in window)) {
                console.log('Browser ntabwo ishyigikira notifications');
                return;
            }
            
            const permissionAsked = localStorage.getItem('notificationPermissionAsked');
            const permission = Notification.permission;
            
            if (permission === 'default' && !permissionAsked) {
                // Show permission request modal
                showNotificationPermissionModal();
            } else if (permission === 'granted') {
                // Show welcome notification
                showWelcomeNotification();
            }
        }
        
        function showNotificationPermissionModal() {
            document.getElementById('notificationPermissionModal').style.display = 'flex';
        }
        
        function enableNotifications() {
            if (!('Notification' in window)) {
                alert('Browser yawe ntabwo ishyigikira notifications');
                return;
            }
            
            Notification.requestPermission().then(permission => {
                localStorage.setItem('notificationPermissionAsked', 'true');
                document.getElementById('notificationPermissionModal').style.display = 'none';
                
                if (permission === 'granted') {
                    localStorage.setItem('notificationPermission', 'granted');
                    showWelcomeNotification();
                    alert('Notifications zemewe! Uraza kubona amatangazo.');
                } else {
                    localStorage.setItem('notificationPermission', 'denied');
                    alert('Notifications ntabwo zemewe. Urashobora guhindura settings muri browser.');
                }
            });
        }
        
        function skipNotifications() {
            localStorage.setItem('notificationPermissionAsked', 'true');
            document.getElementById('notificationPermissionModal').style.display = 'none';
        }
        
        function showWelcomeNotification() {
            if (Notification.permission !== 'granted') return;
            
            const messages = {
                'rw': 'Murakaza neza kuri App y\'Indirimbo za Gatolika!',
                'en': 'Welcome to Catholic Songs App!',
                'fr': 'Bienvenue √† l\'application Chants Catholiques!',
                'sw': 'Karibu kwenye App ya Nyimbo za Kikatoriki!'
            };
            
            const lang = localStorage.getItem('app_language') || 'rw';
            
            const notification = new Notification(messages[lang], {
                body: 'Urakiriye gukoresha app! ‚Ä¢ Enjoy using the app!',
                icon: './icons/icon-192.png',
                badge: './icons/icon-72.png',
                tag: 'welcome-notification'
            });
            
            // Add to user notifications
            addUserNotification({
                id: 'notif-' + Date.now(),
                type: 'welcome',
                title: messages[lang],
                message: 'Urakiriye gukoresha app!',
                timestamp: new Date().toISOString(),
                read: false
            });
        }
        
        function showDownloadNotification(song) {
            if (Notification.permission !== 'granted') return;
            
            const messages = {
                'rw': {
                    title: 'üì• Indirimbo yamanutse',
                    body: `"${song.title}" yamanye neza!`
                },
                'en': {
                    title: 'üì• Song Downloaded',
                    body: `"${song.title}" downloaded successfully!`
                },
                'fr': {
                    title: 'üì• Chant T√©l√©charg√©',
                    body: `"${song.title}" t√©l√©charg√© avec succ√®s!`
                },
                'sw': {
                    title: 'üì• Wimbo Umepakiwa',
                    body: `"${song.title}" umepakiwa kikamilifu!`
                }
            };
            
            const lang = localStorage.getItem('app_language') || 'rw';
            const message = messages[lang];
            
            const notification = new Notification(message.title, {
                body: message.body,
                icon: './icons/icon-192.png',
                badge: './icons/icon-72.png',
                tag: 'download-notification',
                timestamp: Date.now()
            });
            
            // Add to user notifications
            addUserNotification({
                id: 'notif-' + Date.now(),
                type: 'download',
                title: message.title,
                message: message.body,
                timestamp: new Date().toISOString(),
                read: false
            });
            
            // Also send to admin
            sendAdminDownloadNotification(song);
        }
        
        function sendAdminDownloadNotification(song) {
            // Get admin notification settings
            const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
            
            if (!settings.email || !settings.enableNotifications) {
                return;
            }
            
            const messages = {
                'rw': {
                    title: 'üì• User yamanye indirimbo',
                    body: `${currentUser?.name || 'Guest'} yamanye "${song.title}"`
                },
                'en': {
                    title: 'üì• User Downloaded Song',
                    body: `${currentUser?.name || 'Guest'} downloaded "${song.title}"`
                },
                'fr': {
                    title: 'üì• Utilisateur a T√©l√©charg√©',
                    body: `${currentUser?.name || 'Guest'} a t√©l√©charg√© "${song.title}"`
                },
                'sw': {
                    title: 'üì• Mtumiaji Amepakua Wimbo',
                    body: `${currentUser?.name || 'Guest'} amepakua "${song.title}"`
                }
            };
            
            const lang = localStorage.getItem('app_language') || 'rw';
            const message = messages[lang];
            
            // Add to admin notifications
            addAdminNotification({
                id: 'admin-notif-' + Date.now(),
                type: 'user_download',
                title: message.title,
                message: message.body,
                user: currentUser?.name || 'Guest',
                userEmail: currentUser?.email || 'guest@example.com',
                songTitle: song.title,
                songSection: song.section,
                timestamp: new Date().toISOString(),
                read: false
            });
            
            // Simulate email to admin
            console.log(`üìß Email to ${settings.email}: ${message.title} - ${message.body}`);
        }
        
        function showNewSongNotification(song) {
            if (Notification.permission !== 'granted') return;
            
            const messages = {
                'rw': {
                    title: 'üéµ Indirimbo nshya',
                    body: `"${song.title}" yashyizweho muri ${song.section}`
                },
                'en': {
                    title: 'üéµ New Song',
                    body: `"${song.title}" added to ${song.section}`
                },
                'fr': {
                    title: 'üéµ Nouveau Chant',
                    body: `"${song.title}" ajout√© √† ${song.section}`
                },
                'sw': {
                    title: 'üéµ Wimbo Mpya',
                    body: `"${song.title}" umeongezwa kwenye ${song.section}`
                }
            };
            
            const lang = localStorage.getItem('app_language') || 'rw';
            const message = messages[lang];
            
            const notification = new Notification(message.title, {
                body: message.body,
                icon: './icons/icon-192.png',
                badge: './icons/icon-72.png',
                tag: 'new-song-notification',
                timestamp: Date.now()
            });
            
            // Add to user notifications
            addUserNotification({
                id: 'notif-' + Date.now(),
                type: 'new_song',
                title: message.title,
                message: message.body,
                timestamp: new Date().toISOString(),
                read: false
            });
        }
        
        // ===== USER NOTIFICATIONS =====
        function addUserNotification(notification) {
            const notifications = JSON.parse(localStorage.getItem('userNotifications') || '[]');
            notifications.unshift(notification);
            
            // Keep only last 50 notifications
            if (notifications.length > 50) {
                notifications.length = 50;
            }
            
            localStorage.setItem('userNotifications', JSON.stringify(notifications));
            updateNotificationBadge();
            updateNotificationPanel();
        }
        
        function addAdminNotification(notification) {
            const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
            notifications.unshift(notification);
            
            // Keep only last 100 notifications
            if (notifications.length > 100) {
                notifications.length = 100;
            }
            
            localStorage.setItem('adminNotifications', JSON.stringify(notifications));
        }
        
        function loadUserNotifications() {
            const notifications = JSON.parse(localStorage.getItem('userNotifications') || '[]');
            const unreadCount = notifications.filter(n => !n.read).length;
            
            if (unreadCount > 0) {
                document.getElementById('notificationBadge').style.display = 'flex';
                document.getElementById('notificationBadge').textContent = unreadCount;
                notificationCount = unreadCount;
            }
        }
        
        function updateNotificationBadge() {
            const notifications = JSON.parse(localStorage.getItem('userNotifications') || '[]');
            const unreadCount = notifications.filter(n => !n.read).length;
            
            if (unreadCount > 0) {
                document.getElementById('notificationBadge').style.display = 'flex';
                document.getElementById('notificationBadge').textContent = unreadCount;
                notificationCount = unreadCount;
            } else {
                document.getElementById('notificationBadge').style.display = 'none';
                notificationCount = 0;
            }
        }
        
        function updateNotificationPanel() {
            const notifications = JSON.parse(localStorage.getItem('userNotifications') || '[]');
            const panel = document.getElementById('notificationList');
            
            if (notifications.length === 0) {
                panel.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üîî</div>
                        <p data-translate="no_notifications">Nta notifications</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            notifications.slice(0, 20).forEach(notification => {
                const timeAgo = getTimeAgo(notification.timestamp);
                const isUnread = !notification.read ? 'unread' : '';
                
                html += `
                    <div class="notification-item ${isUnread}" onclick="markNotificationAsRead('${notification.id}')">
                        <div class="notification-title">
                            <span>${notification.title}</span>
                            <span class="notification-time">${timeAgo}</span>
                        </div>
                        <div class="notification-message">${notification.message}</div>
                    </div>
                `;
            });
            
            panel.innerHTML = html;
        }
        
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('show');
            
            // Mark all as read when opening
            if (panel.classList.contains('show')) {
                markAllNotificationsAsRead();
            }
        }
        
        function markNotificationAsRead(notificationId) {
            const notifications = JSON.parse(localStorage.getItem('userNotifications') || '[]');
            const notification = notifications.find(n => n.id === notificationId);
            
            if (notification) {
                notification.read = true;
                localStorage.setItem('userNotifications', JSON.stringify(notifications));
                updateNotificationBadge();
                updateNotificationPanel();
            }
        }
        
        function markAllNotificationsAsRead() {
            const notifications = JSON.parse(localStorage.getItem('userNotifications') || '[]');
            notifications.forEach(n => n.read = true);
            localStorage.setItem('userNotifications', JSON.stringify(notifications));
            updateNotificationBadge();
        }
        
        function clearAllNotifications() {
            if (confirm('Urashaka gusiba notifications zose?')) {
                localStorage.setItem('userNotifications', JSON.stringify([]));
                updateNotificationBadge();
                updateNotificationPanel();
                document.getElementById('notificationPanel').classList.remove('show');
            }
        }
        
        function getTimeAgo(timestamp) {
            const now = new Date();
            const past = new Date(timestamp);
            const diff = now - past;
            
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (minutes < 1) return 'Vuba';
            if (minutes < 60) return `${minutes} min`;
            if (hours < 24) return `${hours} h`;
            if (days < 7) return `${days} d`;
            
            return past.toLocaleDateString('rw-RW');
        }
        
        // ===== AUTHENTICATION FUNCTIONS =====
        function setupAuthForms() {
            const signupForm = document.getElementById('signupForm');
            signupForm.addEventListener('submit', handleSignup);
            
            const loginForm = document.getElementById('loginForm');
            loginForm.addEventListener('submit', handleLogin);
            
            document.getElementById('signupEmail').addEventListener('input', validateSignupEmail);
            document.getElementById('signupPassword').addEventListener('input', validateSignupPassword);
            document.getElementById('confirmPassword').addEventListener('input', validateConfirmPassword);
            document.getElementById('loginEmail').addEventListener('input', validateLoginEmail);
            document.getElementById('loginPassword').addEventListener('input', validateLoginPassword);
        }
        
        function checkUserSession() {
            const userData = localStorage.getItem('currentUser');
            const welcomeVisited = localStorage.getItem('welcome_visited');
            
            if (userData) {
                currentUser = JSON.parse(userData);
                showMainContent();
                updateUserProfile();
                
                if (!welcomeVisited) {
                    window.location.href = 'welcome.html';
                }
            }
        }
        
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.auth-tab[onclick*="${tab}"]`).classList.add('active');
            document.getElementById(`${tab}Content`).classList.add('active');
        }
        
        function handleSignup(e) {
            e.preventDefault();
            
            if (!validateSignupForm()) return;
            
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const existingUser = users.find(u => u.email === email);
            
            if (existingUser) {
                showAuthError('signupEmailError', 'Email iyi yararangiriye! Injira.');
                return;
            }
            
            const newUser = {
                id: 'user-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                email: email,
                password: btoa(password),
                name: email.split('@')[0],
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                stats: {
                    downloads: 0,
                    views: 0,
                    songsUploaded: 0,
                    lastActivity: new Date().toISOString()
                }
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            
            document.getElementById('signupSuccess').classList.add('show');
            
            setTimeout(() => {
                window.location.href = 'welcome.html';
            }, 2000);
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            if (!validateLoginForm()) return;
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email && u.password === btoa(password));
            
            if (!user) {
                showAuthError('loginPasswordError', 'Email cyangwa ijambobanga ntabwo ari byo!');
                return;
            }
            
            user.lastLogin = new Date().toISOString();
            localStorage.setItem('users', JSON.stringify(users));
            
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            document.getElementById('loginSuccess').classList.add('show');
            
            setTimeout(() => {
                window.location.href = 'welcome.html';
            }, 2000);
        }
        
        function loginWithGoogle() {
            const email = `user${Date.now()}@gmail.com`;
            const name = email.split('@')[0];
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            let user = users.find(u => u.email === email);
            
            if (!user) {
                user = {
                    id: 'user-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                    email: email,
                    name: name,
                    provider: 'google',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    stats: {
                        downloads: 0,
                        views: 0,
                        songsUploaded: 0,
                        lastActivity: new Date().toISOString()
                    }
                };
                
                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            alert(`Winjiye neza ukoresheje Google!\nEmail: ${email}`);
            window.location.href = 'welcome.html';
        }
        
        function continueWithoutLogin() {
            const guestUser = {
                id: 'guest-' + Date.now(),
                email: 'guest@example.com',
                name: 'Guest',
                isGuest: true,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                stats: {
                    downloads: 0,
                    views: 0,
                    songsUploaded: 0,
                    lastActivity: new Date().toISOString()
                }
            };
            
            currentUser = guestUser;
            localStorage.setItem('currentUser', JSON.stringify(guestUser));
            window.location.href = 'welcome.html';
        }
        
        function logoutUser() {
            if (confirm('Urashaka gusohoka?')) {
                localStorage.removeItem('currentUser');
                currentUser = null;
                location.reload();
            }
        }
        
        function showMainContent() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('userProfile').classList.add('show');
            
            loadSongs();
            createNavigation();
        }
        
        function updateUserProfile() {
            if (!currentUser) return;
            
            document.getElementById('userEmailDisplay').textContent = currentUser.email;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('userDownloads').textContent = currentUser.stats?.downloads || 0;
            document.getElementById('userViews').textContent = currentUser.stats?.views || 0;
        }
        
        function updateUserStats(action) {
            if (!currentUser) return;
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                if (action === 'download') {
                    currentUser.stats.downloads = (currentUser.stats.downloads || 0) + 1;
                } else if (action === 'view') {
                    currentUser.stats.views = (currentUser.stats.views || 0) + 1;
                }
                
                currentUser.stats.lastActivity = new Date().toISOString();
                users[userIndex] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                updateUserProfile();
            }
        }
        
        // ===== VALIDATION FUNCTIONS =====
        function validateSignupEmail() {
            const email = document.getElementById('signupEmail').value.trim();
            const errorElement = document.getElementById('signupEmailError');
            
            if (!email) {
                showAuthError('signupEmailError', 'Email irikenewe!');
                return false;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showAuthError('signupEmailError', 'Shyiramo email nterinze!');
                return false;
            }
            
            errorElement.classList.remove('show');
            return true;
        }
        
        function validateSignupPassword() {
            const password = document.getElementById('signupPassword').value;
            const errorElement = document.getElementById('signupPasswordError');
            
            if (!password) {
                showAuthError('signupPasswordError', 'Ijambobanga rirakenewe!');
                return false;
            }
            
            if (password.length < 6) {
                showAuthError('signupPasswordError', 'Ijambobanga rigomba kuba rimaze imibare 6!');
                return false;
            }
            
            errorElement.classList.remove('show');
            return true;
        }
        
        function validateConfirmPassword() {
            const password = document.getElementById('signupPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            const errorElement = document.getElementById('confirmPasswordError');
            
            if (!confirm) {
                showAuthError('confirmPasswordError', 'Emeza ijambobanga!');
                return false;
            }
            
            if (password !== confirm) {
                showAuthError('confirmPasswordError', 'Ijambobanga ntabwo bihuye!');
                return false;
            }
            
            errorElement.classList.remove('show');
            return true;
        }
        
        function validateLoginEmail() {
            const email = document.getElementById('loginEmail').value.trim();
            const errorElement = document.getElementById('loginEmailError');
            
            if (!email) {
                showAuthError('loginEmailError', 'Email irikenewe!');
                return false;
            }
            
            errorElement.classList.remove('show');
            return true;
        }
        
        function validateLoginPassword() {
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('loginPasswordError');
            
            if (!password) {
                showAuthError('loginPasswordError', 'Ijambobanga rirakenewe!');
                return false;
            }
            
            errorElement.classList.remove('show');
            return true;
        }
        
        function validateSignupForm() {
            return validateSignupEmail() && validateSignupPassword() && validateConfirmPassword();
        }
        
        function validateLoginForm() {
            return validateLoginEmail() && validateLoginPassword();
        }
        
        function showAuthError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.add('show');
            return false;
        }
        
        // ===== CONTACT FORM FUNCTIONS =====
        function setupContactForm() {
            const form = document.getElementById('contactForm');
            const emailInput = document.getElementById('userEmail');
            const messageInput = document.getElementById('userMessage');
            const sendButton = document.getElementById('sendButton');
            
            emailInput.addEventListener('input', validateContactEmail);
            messageInput.addEventListener('input', validateContactMessage);
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (validateContactEmail() && validateContactMessage()) {
                    sendContactMessage();
                }
            });
        }
        
        function validateContactEmail() {
            const email = document.getElementById('userEmail').value.trim();
            const emailError = document.getElementById('emailError');
            const sendButton = document.getElementById('sendButton');
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!email) {
                emailError.textContent = 'Email irikenewe!';
                emailError.classList.add('show');
                sendButton.disabled = true;
                return false;
            }
            
            if (!emailRegex.test(email)) {
                emailError.textContent = 'Shyiramo email nterinze!';
                emailError.classList.add('show');
                sendButton.disabled = true;
                return false;
            }
            
            emailError.classList.remove('show');
            updateContactSendButton();
            return true;
        }
        
        function validateContactMessage() {
            const message = document.getElementById('userMessage').value.trim();
            const messageError = document.getElementById('messageError');
            const sendButton = document.getElementById('sendButton');
            
            if (!message) {
                messageError.textContent = 'Ubutumwa bukenewe!';
                messageError.classList.add('show');
                sendButton.disabled = true;
                return false;
            }
            
            if (message.length < 10) {
                messageError.textContent = 'Ubutumwa burakenewe (min: 10 imibare)!';
                messageError.classList.add('show');
                sendButton.disabled = true;
                return false;
            }
            
            messageError.classList.remove('show');
            updateContactSendButton();
            return true;
        }
        
        function updateContactSendButton() {
            const emailValid = validateContactEmail();
            const messageValid = validateContactMessage();
            const sendButton = document.getElementById('sendButton');
            
            sendButton.disabled = !(emailValid && messageValid);
        }
        
        function sendContactMessage() {
            const email = document.getElementById('userEmail').value.trim();
            const message = document.getElementById('userMessage').value.trim();
            const sendButton = document.getElementById('sendButton');
            const successMessage = document.getElementById('formSuccess');
            
            sendButton.disabled = true;
            sendButton.innerHTML = `<span>‚è≥</span> Iri gukora...`;
            
            setTimeout(() => {
                const contacts = JSON.parse(localStorage.getItem('userContacts') || '[]');
                contacts.unshift({
                    email: email,
                    message: message,
                    date: new Date().toLocaleString('rw-RW'),
                    read: false
                });
                
                if (contacts.length > 100) {
                    contacts.length = 100;
                }
                
                localStorage.setItem('userContacts', JSON.stringify(contacts));
                
                successMessage.classList.add('show');
                
                // Add notification
                addUserNotification({
                    id: 'notif-' + Date.now(),
                    type: 'contact',
                    title: 'üìß Ubutumwa bwawe bwoherejwe',
                    message: 'Turabasubiza vuba',
                    timestamp: new Date().toISOString(),
                    read: false
                });
                
                // Send notification to admin
                const adminNotification = {
                    id: 'admin-notif-' + Date.now(),
                    type: 'contact',
                    title: 'üìß Ubutumwa bushya',
                    message: `${email}: ${message.substring(0, 50)}...`,
                    userEmail: email,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                addAdminNotification(adminNotification);
                
                setTimeout(() => {
                    document.getElementById('contactForm').reset();
                    successMessage.classList.remove('show');
                    sendButton.disabled = false;
                    sendButton.innerHTML = `<span>üì§</span> ${LanguageManager.getTranslation('send_message')}`;
                    hideContactForm();
                    
                    alert(`Ubutumwa bwawe bwoherejwe!\n\nTurabasubiza vuba.\nEmail: ${email}`);
                }, 2000);
                
            }, 1500);
        }
        
        function showContactForm() {
            if (currentUser && !currentUser.isGuest) {
                document.getElementById('userEmail').value = currentUser.email;
                validateContactEmail();
            }
            
            document.getElementById('contactModal').classList.add('active');
            document.getElementById('userMessage').focus();
        }
        
        function hideContactForm() {
            document.getElementById('contactModal').classList.remove('active');
            document.getElementById('formSuccess').classList.remove('show');
            document.getElementById('emailError').classList.remove('show');
            document.getElementById('messageError').classList.remove('show');
        }
        
        // ===== PWA FUNCTIONS =====
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered');
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            }
        }
        
        function setupInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                setTimeout(() => {
                    document.getElementById('pwaButton').style.display = 'inline-block';
                }, 10000);
            });
        }
        
        function showPWAInfo() {
            const message = `Kwinjiza App:\n\n1. Kwinjiza app ku phone yawe\n2. Gukoresha nta internet (offline)\n3. Kubona notifications\n4. Gufunguka nk'app\n\nUrashaka kuyinjiiza?`;
            
            if (confirm(message)) {
                installPWA();
            }
        }
        
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showPWAAlert(`Byakozwe! App yinjiye`);
                    }
                    deferredPrompt = null;
                });
            } else {
                showPWAAlert(`Ikosa: App ntabwo ishobora kwinjizwa muri browser iyi.`);
            }
        }
        
        function updateOnlineStatus() {
            const songCount = document.getElementById('songCount');
            const originalText = songCount.textContent;
            
            window.addEventListener('online', () => {
                if (songCount.textContent.includes('(Offline)')) {
                    songCount.textContent = originalText.replace(' (Offline)', '');
                }
                showPWAAlert(`Online`);
                checkForSongUpdates();
            });
            
            window.addEventListener('offline', () => {
                if (!songCount.textContent.includes('(Offline)')) {
                    songCount.textContent = originalText + ` (Offline)`;
                }
                showPWAAlert(`Offline - Indirimbo zakushe zirabaho`);
            });
            
            if (!navigator.onLine) {
                songCount.textContent = originalText + ` (Offline)`;
            }
        }
        
        function showPWAAlert(message) {
            const notification = document.getElementById('pwaNotification');
            document.getElementById('pwaMessage').textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        function hidePWANotification() {
            document.getElementById('pwaNotification').style.display = 'none';
        }
        
        // ===== SONG MANAGEMENT =====
        function loadSongs() {
            allSongs = JSON.parse(localStorage.getItem('catholicSongs') || '[]');
            
            if (allSongs.length === 0) {
                document.getElementById('sectionsContainer').innerHTML = `
                    <div class="section active">
                        <h2>${LanguageManager.getTranslation('songs')}</h2>
                        <div class="no-songs">
                            <p>${LanguageManager.getTranslation('no_songs')}</p>
                            <p>Admin azazishyiramo mu gihe gito.</p>
                            <p style="font-size: 14px; margin-top: 20px; color: #4b0082;">
                                üîî Kanda "Admin Login" niba uri admin.
                            </p>
                        </div>
                    </div>
                `;
                updateSongCount();
                return;
            }
            
            updateSongCount();
            displayAllSongs();
        }
        
        function checkForSongUpdates() {
            const lastUpdate = localStorage.getItem('lastSongUpdate') || '0';
            const currentSongs = JSON.parse(localStorage.getItem('catholicSongs') || '[]');
            
            if (currentSongs.length !== allSongs.length) {
                console.log('üîÑ Hari indirimbo nshya!');
                const previousLength = allSongs.length;
                allSongs = currentSongs;
                displayAllSongs();
                updateSongCount();
                
                // Show notification for new songs
                const newSongs = currentSongs.slice(previousLength);
                
                newSongs.forEach(song => {
                    showNewSongNotification(song);
                });
            }
            
            localStorage.setItem('lastSongUpdate', Date.now().toString());
        }
        
        function updateSongCount() {
            const countElement = document.getElementById('songCount');
            if (countElement) {
                const text = `${LanguageManager.getTranslation('welcome_subtitle')}`;
                countElement.setAttribute('data-translate', 'welcome_subtitle');
                countElement.textContent = text;
            }
        }
        
        function displayAllSongs() {
            const container = document.getElementById('sectionsContainer');
            
            const sections = {};
            allSongs.forEach(song => {
                if (!sections[song.section]) {
                    sections[song.section] = [];
                }
                sections[song.section].push(song);
            });
            
            if (Object.keys(sections).length === 0) {
                container.innerHTML = `
                    <div class="section active">
                        <h2>${LanguageManager.getTranslation('songs')}</h2>
                        <div class="no-songs">
                            <p>${LanguageManager.getTranslation('no_songs')}</p>
                            <p>Admin azazishyiramo mu gihe gito.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            for (const [sectionName, sectionSongs] of Object.entries(sections)) {
                html += `
                    <div class="section" id="section-${sectionName.replace(/\s+/g, '-')}">
                        <h2>${sectionName} <span style="font-size: 16px; color: #666;">(${sectionSongs.length})</span></h2>
                        <div class="songs-list">
                `;
                
                sectionSongs.forEach(song => {
                    html += `
                        <div class="song" id="user-song-${song.id}">
                            <div class="song-header">
                                <h3 class="song-title">${song.title}</h3>
                                <span class="song-date">${song.dateAdded || 'Vuba'}</span>
                            </div>
                            <div class="song-meta">
                                <span class="song-section">${song.section}</span>
                                <span class="song-size">${song.fileSize || 'N/A'}</span>
                                <span class="download-count" id="count-${song.id}">üîΩ ${song.downloadCount || 0}</span>
                            </div>
                            <div class="song-actions">
                                <button class="download-btn" onclick="downloadSong('${song.id}')">
                                    <span>‚¨áÔ∏è</span> ${LanguageManager.getTranslation('download_user')}
                                </button>
                                <button class="play-btn" onclick="previewSong('${song.id}')">
                                    <span>üëÅÔ∏è</span> ${LanguageManager.getTranslation('preview_user')}
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
            if (Object.keys(sections).length > 0) {
                showSection(Object.keys(sections)[0]);
            }
        }
        
        function createNavigation() {
            updateSectionNav();
            updateSectionDropdowns();
        }
        
        function updateSectionNav() {
            const sections = [
                'intro', 'forgiveness', 'glory_to_god', 'psalms', 'alleluia',
                'creed', 'prayers', 'offertory', 'holy', 'lamb_of_god',
                'communion', 'thanksgiving', 'conclusion', 'mary', 'saints',
                'wedding', 'funeral', 'advent', 'christmas', 'lent', 'easter',
                'ascension', 'pentecost', 'other_songs'
            ];
            
            const nav = document.getElementById('sectionNav');
            nav.innerHTML = '';
            
            const allButton = document.createElement('button');
            allButton.textContent = LanguageManager.getTranslation('all_sections');
            allButton.onclick = () => {
                document.getElementById('sectionFilter').value = '';
                clearFilters();
            };
            nav.appendChild(allButton);
            
            sections.forEach(sectionKey => {
                const button = document.createElement('button');
                button.textContent = LanguageManager.getTranslation(sectionKey);
                button.onclick = () => {
                    document.getElementById('sectionFilter').value = LanguageManager.getTranslation(sectionKey);
                    filterBySection();
                };
                nav.appendChild(button);
            });
        }
        
        function updateSectionDropdowns() {
            const sections = [
                'intro', 'forgiveness', 'glory_to_god', 'psalms', 'alleluia',
                'creed', 'prayers', 'offertory', 'holy', 'lamb_of_god',
                'communion', 'thanksgiving', 'conclusion', 'mary', 'saints',
                'wedding', 'funeral', 'advent', 'christmas', 'lent', 'easter',
                'ascension', 'pentecost', 'other_songs'
            ];
            
            const sectionFilter = document.getElementById('sectionFilter');
            
            // Clear existing options except first one
            while (sectionFilter.options.length > 1) {
                sectionFilter.remove(1);
            }
            
            sections.forEach(sectionKey => {
                const option = document.createElement('option');
                option.value = LanguageManager.getTranslation(sectionKey);
                option.textContent = LanguageManager.getTranslation(sectionKey);
                sectionFilter.appendChild(option);
            });
        }
        
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            const section = document.getElementById(`section-${sectionName.replace(/\s+/g, '-')}`);
            if (section) {
                section.classList.add('active');
            }
            
            document.querySelectorAll('#sectionNav button').forEach(btn => {
                btn.style.background = btn.textContent === sectionName ? '#4b0082' : 'rgba(255,255,255,0.2)';
            });
        }
        
        // ===== SEARCH AND FILTER =====
        function searchSongs() {
            currentSearchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (!currentSearchTerm) {
                displayAllSongs();
                return;
            }
            
            const filteredSongs = allSongs.filter(song => 
                song.title.toLowerCase().includes(currentSearchTerm) ||
                song.section.toLowerCase().includes(currentSearchTerm)
            );
            
            if (filteredSongs.length === 0) {
                document.getElementById('sectionsContainer').innerHTML = `
                    <div class="section active">
                        <h2>${LanguageManager.getTranslation('search')}: "${currentSearchTerm}"</h2>
                        <div class="no-songs">
                            <p>Nta ndirimbo zihuye na "${currentSearchTerm}".</p>
                        </div>
                    </div>
                `;
            } else {
                displaySearchResults(filteredSongs);
            }
        }
        
        function displaySearchResults(songs) {
            let html = `
                <div class="section active">
                    <h2>${LanguageManager.getTranslation('search')}: "${currentSearchTerm}" (${songs.length})</h2>
                    <div class="songs-list">
            `;
            
            songs.forEach(song => {
                html += `
                    <div class="song" id="user-song-${song.id}">
                        <div class="song-header">
                            <h3 class="song-title">${song.title}</h3>
                            <span class="song-date">${song.dateAdded || 'Vuba'}</span>
                        </div>
                        <div class="song-meta">
                            <span class="song-section">${song.section}</span>
                            <span class="song-size">${song.fileSize || 'N/A'}</span>
                            <span class="download-count" id="count-${song.id}">üîΩ ${song.downloadCount || 0}</span>
                        </div>
                        <div class="song-actions">
                            <button class="download-btn" onclick="downloadSong('${song.id}')">
                                <span>‚¨áÔ∏è</span> ${LanguageManager.getTranslation('download_user')}
                            </button>
                            <button class="play-btn" onclick="previewSong('${song.id}')">
                                <span>üëÅÔ∏è</span> ${LanguageManager.getTranslation('preview_user')}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            document.getElementById('sectionsContainer').innerHTML = html;
        }
        
        function filterBySection() {
            const section = document.getElementById('sectionFilter').value;
            currentFilterSection = section;
            
            if (!section) {
                displayAllSongs();
                return;
            }
            
            const filteredSongs = allSongs.filter(song => song.section === section);
            
            if (filteredSongs.length === 0) {
                document.getElementById('sectionsContainer').innerHTML = `
                    <div class="section active">
                        <h2>${section}</h2>
                        <div class="no-songs">
                            <p>Nta ndirimbo zirimo muri "${section}".</p>
                        </div>
                    </div>
                `;
            } else {
                displaySectionFilterResults(filteredSongs, section);
            }
        }
        
        function displaySectionFilterResults(songs, sectionName) {
            let html = `
                <div class="section active">
                    <h2>${sectionName} (${songs.length})</h2>
                    <div class="songs-list">
            `;
            
            songs.forEach(song => {
                html += `
                    <div class="song" id="user-song-${song.id}">
                        <div class="song-header">
                            <h3 class="song-title">${song.title}</h3>
                            <span class="song-date">${song.dateAdded || 'Vuba'}</span>
                        </div>
                        <div class="song-meta">
                            <span class="song-section">${song.section}</span>
                            <span class="song-size">${song.fileSize || 'N/A'}</span>
                            <span class="download-count" id="count-${song.id}">üîΩ ${song.downloadCount || 0}</span>
                        </div>
                        <div class="song-actions">
                            <button class="download-btn" onclick="downloadSong('${song.id}')">
                                <span>‚¨áÔ∏è</span> ${LanguageManager.getTranslation('download_user')}
                            </button>
                            <button class="play-btn" onclick="previewSong('${song.id}')">
                                <span>üëÅÔ∏è</span> ${LanguageManager.getTranslation('preview_user')}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            document.getElementById('sectionsContainer').innerHTML = html;
        }
        
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('sectionFilter').value = '';
            currentSearchTerm = '';
            currentFilterSection = '';
            displayAllSongs();
            alert(`Byakozwe! Byose byasubijwe!`);
        }
        
        // ===== SONG ACTIONS =====
        function downloadSong(songId) {
            const song = allSongs.find(s => s.id === songId);
            
            if (!song) {
                alert(`Ikosa: Indirimbo ntabwo iboneka!`);
                loadSongs();
                return;
            }
            
            song.downloadCount = (song.downloadCount || 0) + 1;
            
            const songs = JSON.parse(localStorage.getItem('catholicSongs') || '[]');
            const index = songs.findIndex(s => s.id === songId);
            
            if (index !== -1) {
                songs[index] = song;
                localStorage.setItem('catholicSongs', JSON.stringify(songs));
                
                const countElement = document.getElementById(`count-${songId}`);
                if (countElement) {
                    countElement.textContent = `üîΩ ${song.downloadCount}`;
                }
                
                updateUserStats('download');
                
                showDownloadNotification(song);
                
                setTimeout(() => {
                    alert(`"${song.title}" yamanutse neza!\nüî¢ Download count: ${song.downloadCount}`);
                }, 500);
            }
            
            const link = document.createElement('a');
            link.href = song.fileUrl;
            link.download = song.title + (song.fileType === 'MP3' ? '.mp3' : 
                          song.fileType === 'PDF' ? '.pdf' : 
                          song.fileType === 'JPG' ? '.jpg' :
                          song.fileType === 'PNG' ? '.png' : '.file');
            
            link.click();
            
            setTimeout(() => {
                URL.revokeObjectURL(link.href);
            }, 1000);
        }
        
        function previewSong(songId) {
            const song = allSongs.find(s => s.id === songId);
            
            if (!song) {
                alert(`Ikosa: Indirimbo ntabwo iboneka!`);
                return;
            }
            
            updateUserStats('view');
            
            if (song.fileType === 'MP3') {
                const audio = new Audio(song.fileUrl);
                audio.play().catch(e => {
                    window.open(song.fileUrl, '_blank');
                });
                
                alert(`"${song.title}" iri kuririmba...`);
            } else {
                window.open(song.fileUrl, '_blank');
            }
        }
        
        // ===== CLEANUP =====
        window.addEventListener('beforeunload', function() {
            if (songUpdateInterval) {
                clearInterval(songUpdateInterval);
            }
        });
        
        // Initialize app
        window.onload = initApp;
    </script>
</body>

</html>


